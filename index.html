<!DOCTYPE HTML>
<html>
<head>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
<div class="container">
	<div class="jumbotron">
		<h2>Rejseplanen på Pebble</h2>
		<div class="form-group">
			<pre style="font-size: large;">
Find stationen/stoppestedet ved at søge herunder. 
OBS vær opmærksom på at vælge et element fra listen!</pre>
			<label for="home">Hjem:&nbsp; </label><input id="hjem" class="form-control" name="home" onkeyup="search(this.value, this)"></input>
			<div width=100 height=100 id="livesearchhjem"></div>
			<label for="dest">Arbejde:&nbsp; </label><input id="arbejde" onkeyup="search(this.value, this)" class="form-control" name="dest"></input>
			<div width=100 height=100 id="livesearcharbejde"></div>
			<br><br><button onclick="submit()" type="button" class="btn btn-primary">Save</button>
		</div>
	</div>
</div>
<script>
var data;

	function clear(el){
		while(el.firstChild){
			el.removeChild(el.firstChild);
		}
	}
	
	function set(id, el){
		var target = document.getElementById(el);
		target.value = id;
		clear(document.getElementById("livesearch" + el));
	}
	
	function search(str, elm){
		if(str && parseInt(str) != NaN){
			
			var d = $.ajax({
				url: 'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%3D%22http%3A%2F%2Fxmlopen.rejseplanen.dk%2Fbin%2Frest.exe%2Flocation%3Fformat%3Djson%26input%3D' + encodeURI(str) + '%22&format=json&diagnostics=true&callback=?',
				jsonp: "?",
				dataType: "jsonp",
				success: function(d){
					var target = document.getElementById("livesearch" + elm.id);
					clear(target);
					for(var el in d.query.results.LocationList.StopLocation){
						var link = document.createElement("a");
						link.setAttribute("onclick", "set('" + d.query.results.LocationList.StopLocation[el].id + "','" + elm.id + "');");
						link.innerHTML = d.query.results.LocationList.StopLocation[el].name
						target.appendChild(link);
						target.appendChild(document.createElement("br"));
					}
				},
				error: function(e){
					console.log(e);
				}
			});
		}
	}
	
	function submit(){
		var hjem = document.getElementById("hjem").value;
		var arbejde = document.getElementById("arbejde").value;
		if(parseInt(hjem) != NaN && parseInt(arbejde) != NaN){
			window.location.href = 'pebblejs://close#success?origin=' + hjem + "&dest=" + arbejde;
		}
		
	}

</script>
</body>
</html>
